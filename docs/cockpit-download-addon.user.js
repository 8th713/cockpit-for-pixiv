/*
// ==UserScript==
// @name         cockpit download addon
// @description  cockpit download helper addon.
// @version      4.0.0-alpha.1
// @author       8th713
// @homepage     https://github.com/8th713/cockpit-for-pixiv
// @supportURL   https://github.com/8th713/cockpit-for-pixiv/issues
// @license      MIT
// @namespace    http://github.com/8th713
// @match        https://www.pixiv.net/*
// @exclude      https://www.pixiv.net/novel/*
// @exclude      https://www.pixiv.net/member_illust.php?mode*
// @grant        unsafeWindow
// @grant        GM_xmlhttpRequest
// @connect      i.pximg.net
// @connect      pixiv.net
// ==/UserScript==
*/!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=29)}({29:function(t,e,r){"use strict";function n(t){const e=t.lastIndexOf(".");return t.slice(e+1)}function o(t){return new Promise((e,r)=>{GM_xmlhttpRequest({url:t,responseType:"blob",method:"GET",headers:{referer:t},onload:t=>e(t.response),onerror:r})})}function i(t,e){const r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(t),r.download=e,r.click(),setTimeout(()=>{window.URL.revokeObjectURL(r.href)},100)}r.r(e);var s=r(4);function u(t){return Object(s.a)(`/ajax/illust/${t}/pages`).options({credentials:"same-origin",cache:"no-cache"}).content("application/json").errorType("json").resolve(t=>t.json(t=>t.body)).get()}function a(t){return 2===t.illustType?async function(t){const{id:e,title:r,userName:n}=t,u=await function(t){return Object(s.a)(`/ajax/illust/${t}/ugoira_meta`).options({credentials:"same-origin",cache:"no-cache"}).content("application/json").errorType("json").resolve(t=>t.json(t=>t.body)).get()}(e);i(await o(u.originalSrc),`${n} - ${r}.zip`)}(t):t.pageCount>1?async function(t){const{id:e,title:r,userName:s}=t,a=await u(e),c=new unsafeWindow.JSZip;for(const[t,e]of a.entries()){const i=e.urls.original,u=n(i),a=String(t).padStart(3,"000"),l=`${s} - ${r}[${a}].${u}`,f=await o(i);c.file(l,f)}i(await c.generateAsync({type:"blob"}),`${s} - ${r}.zip`)}(t):async function(t){const{id:e,title:r,userName:s}=t,[a]=await u(e),c=a.urls.original,l=await o(c),f=n(c);i(l,`${s} - ${r}.${f}`)}(t)}const c=new MessageChannel,{port1:l,port2:f}=c;l.addEventListener("message",t=>{const e=t.data;if(!1!==function(t){return t&&"object"===typeof t&&"string"===typeof t.type}(e))switch(e.type){case"CONNECTION-SUCCESS":return void function(t){const e=document.createElement("script");e.src=t,document.body.appendChild(e)}("https://unpkg.com/jszip@3.1.5/dist/jszip.min.js");case"DOWNLOAD_REQUEST":return void a(e.payload);default:console.error("Unknown Action",e)}}),l.start(),window.postMessage({type:"CONNECTION-REQUEST",id:"download"},location.origin,[f])},3:function(t,e,r){"use strict";(function(t){var r={defaults:{},errorType:null,polyfills:{fetch:null,FormData:null,URLSearchParams:null,performance:null,PerformanceObserver:null,AbortController:null},polyfill:function(e,r){for(var n=void 0===r?{}:r,o=n.doThrow,i=void 0===o||o,s=n.instance,u=void 0!==s&&s,a=[],c=2;c<arguments.length;c++)a[c-2]=arguments[c];var l=this.polyfills[e]||("undefined"!==typeof self?self[e]:null)||("undefined"!==typeof t?t[e]:null);if(i&&!l)throw new Error(e+" is not defined");return u&&l?new(l.bind.apply(l,[void 0].concat(a))):l}};e.a=r}).call(this,r(5))},4:function(t,e,r){"use strict";var n=function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=function(t,e,r){if(void 0===r&&(r=!1),!t||!e||"object"!==typeof t||"object"!==typeof e)return t;var i=n({},t);for(var s in e)e.hasOwnProperty(s)&&(e[s]instanceof Array&&t[s]instanceof Array?i[s]=r?t[s].concat(e[s]):e[s]:"object"===typeof e[s]&&"object"===typeof t[s]?i[s]=o(t[s],e[s],r):i[s]=e[s]);return i},i=r(3),s=function(t,e,r,n){if(!t.getEntriesByName)return!1;var o=t.getEntriesByName(e);return!!(o&&o.length>0)&&(r(o.reverse()[0]),n.clearMeasures&&n.clearMeasures(e),u.callbacks.delete(e),u.callbacks.size<1&&(u.observer.disconnect(),n.clearResourceTimings&&n.clearResourceTimings()),!0)},u={callbacks:new Map,observer:null,observe:function(t,e){if(t&&e){var r=i.a.polyfill("performance",{doThrow:!1});(function(t,e){return!u.observer&&t&&e&&(u.observer=new e(function(e){u.callbacks.forEach(function(r,n){s(e,n,r,t)})}),t.clearResourceTimings&&t.clearResourceTimings()),u.observer})(r,i.a.polyfill("PerformanceObserver",{doThrow:!1}))&&(s(r,t,e,r)||(u.callbacks.size<1&&u.observer.observe({entryTypes:["resource","measure"]}),u.callbacks.set(t,e)))}}},a=u,c=function(){return(c=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},l=function(){function t(t,e,r,n,o,i){void 0===r&&(r=new Map),void 0===n&&(n=[]),void 0===o&&(o=[]),void 0===i&&(i=[]),this._url=t,this._options=e,this._catchers=r,this._resolvers=n,this._middlewares=o,this._deferredChain=i}return t.factory=function(e,r){return void 0===e&&(e=""),void 0===r&&(r={}),new t(e,r)},t.prototype.selfFactory=function(e){var r=void 0===e?{}:e,n=r.url,o=void 0===n?this._url:n,i=r.options,s=void 0===i?this._options:i,u=r.catchers,a=void 0===u?this._catchers:u,c=r.resolvers,l=void 0===c?this._resolvers:c,f=r.middlewares,p=void 0===f?this._middlewares:f,d=r.deferredChain;return new t(o,s,a,l,p,void 0===d?this._deferredChain:d)},t.prototype.defaults=function(t,e){return void 0===e&&(e=!1),i.a.defaults=e?o(i.a.defaults,t):t,this},t.prototype.errorType=function(t){return i.a.errorType=t,this},t.prototype.polyfills=function(t){return i.a.polyfills=c({},i.a.polyfills,t),this},t.prototype.url=function(t,e){if(void 0===e&&(e=!1),e)return this.selfFactory({url:t});var r=this._url.split("?");return this.selfFactory({url:r.length>1?r[0]+t+"?"+r[1]:this._url+t})},t.prototype.options=function(t,e){return void 0===e&&(e=!0),this.selfFactory({options:e?o(this._options,t):t})},t.prototype.query=function(t,e){return void 0===e&&(e=!1),this.selfFactory({url:f(this._url,t,e)})},t.prototype.headers=function(t){return this.selfFactory({options:o(this._options,{headers:t})})},t.prototype.accept=function(t){return this.headers({Accept:t})},t.prototype.content=function(t){return this.headers({"Content-Type":t})},t.prototype.auth=function(t){return this.headers({Authorization:t})},t.prototype.catcher=function(t,e){var r=new Map(this._catchers);return r.set(t,e),this.selfFactory({catchers:r})},t.prototype.signal=function(t){return this.selfFactory({options:c({},this._options,{signal:t.signal})})},t.prototype.resolve=function(t,e){return void 0===e&&(e=!1),this.selfFactory({resolvers:e?[t]:this._resolvers.concat([t])})},t.prototype.defer=function(t,e){return void 0===e&&(e=!1),this.selfFactory({deferredChain:e?[t]:this._deferredChain.concat([t])})},t.prototype.middlewares=function(t,e){return void 0===e&&(e=!1),this.selfFactory({middlewares:e?t:this._middlewares.concat(t)})},t.prototype.method=function(t,e,r){void 0===e&&(e={}),void 0===r&&(r=null);var n=r?"object"===typeof r?this.json(r):this.body(r):this;return function(t){var e=t._url,r=t._catchers,n=t._resolvers,s=t._middlewares,u=t._options,c=o(i.a.defaults,u),l=i.a.polyfill("AbortController",{doThrow:!1,instance:!0});!c.signal&&l&&(c.signal=l.signal);var f=function(t){return function(e){return 0===t.length?e:1===t.length?t[0](e):t.reduceRight(function(r,n,o){return o===t.length-2?n(r(e)):n(r)})}}(s)(i.a.polyfill("fetch"))(e,c),p=f.then(function(t){return t.ok?t:t[i.a.errorType||"text"]().then(function(e){var r=new Error(e);throw r[i.a.errorType||"text"]=e,r.status=t.status,r.response=t,r})}),d=function(e){return e.catch(function(e){if(r.has(e.status))return r.get(e.status)(e,t);if(r.has(e.name))return r.get(e.name)(e,t);throw e})},h=function(t){return function(e){return d(t?p.then(function(e){return e&&e[t]()}).then(function(t){return t&&e&&e(t)||t}):p.then(function(t){return t&&e&&e(t)||t}))}},y={res:h(null),json:h("json"),blob:h("blob"),formData:h("formData"),arrayBuffer:h("arrayBuffer"),text:h("text"),perfs:function(t){return f.then(function(e){return a.observe(e.url,t)}),y},setTimeout:function(t,e){return void 0===e&&(e=l),setTimeout(function(){return e.abort()},t),y},controller:function(){return[l,y]},error:function(t,e){return r.set(t,e),y},badRequest:function(t){return y.error(400,t)},unauthorized:function(t){return y.error(401,t)},forbidden:function(t){return y.error(403,t)},notFound:function(t){return y.error(404,t)},timeout:function(t){return y.error(408,t)},internalError:function(t){return y.error(500,t)},onAbort:function(t){return y.error("AbortError",t)}};return n.reduce(function(e,r){return r(e,t)},y)}(n._deferredChain.reduce(function(t,e){return e(t,t._url,t._options)},n).options(c({},e,{method:t})))},t.prototype.get=function(t){return this.method("GET",t)},t.prototype.delete=function(t){return this.method("DELETE",t)},t.prototype.put=function(t,e){return this.method("PUT",e,t)},t.prototype.post=function(t,e){return this.method("POST",e,t)},t.prototype.patch=function(t,e){return this.method("PATCH",e,t)},t.prototype.head=function(t){return this.method("HEAD",t)},t.prototype.opts=function(t){return this.method("OPTIONS",t)},t.prototype.body=function(t){return this.selfFactory({options:c({},this._options,{body:t})})},t.prototype.json=function(t){return this.content("application/json").body(JSON.stringify(t))},t.prototype.formData=function(t){return this.body(function(t){var e=i.a.polyfill("FormData",{instance:!0});for(var r in t)if(t[r]instanceof Array)for(var n=0,o=t[r];n<o.length;n++){var s=o[n];e.append(r+"[]",s)}else e.append(r,t[r]);return e}(t))},t.prototype.formUrl=function(t){return this.body("string"===typeof t?t:(e=t,Object.keys(e).map(function(t){var r=e[t];return r instanceof Array?r.map(function(e){return p(t,e)}).join("&"):p(t,r)}).join("&"))).content("application/x-www-form-urlencoded");var e},t}(),f=function(t,e,r){var n;if("string"===typeof e)n=e;else{var o=i.a.polyfill("URLSearchParams",{instance:!0});for(var s in e)if(e[s]instanceof Array)for(var u=0,a=e[s];u<a.length;u++){var c=a[u];o.append(s,c)}else o.append(s,e[s]);n=o.toString()}var l=t.split("?");return r||l.length<2?l[0]+"?"+n:t+"&"+n};function p(t,e){return encodeURIComponent(t)+"="+encodeURIComponent("object"===typeof e?JSON.stringify(e):""+e)}var d=l.factory;d.default=l.factory;e.a=d},5:function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"===typeof window&&(r=window)}t.exports=r}});